pipeline {
  agent any
  stages {
    stage('Shell script 0') {
      steps {
        sh '''
        #!/bin/bash
        cd $PATHTO
        SHELL_SCRIPTS=$(find . -name \'*.sh\')
        for var in $SHELL_SCRIPTS ; do
        shellcheck "$var"
        done
        '''
      }
    }    
    stage('Shell script 1') {
      steps {
        sh '''
        #!/bin/bash
        DOCKERFILE=$(find "$PATHTO" -name \'Dockerfile\')
        for var in $DOCKERFILE ; do
        dockerfile_lint  -f "$var"
        done
        '''
      }
    }
    stage('Push images') {
      steps {
        script {
          def dockerImage = docker.build("${REPO_USR}/${NAME_IMG}", "-f ${PATHTO}/Dockerfile .")
          docker.withRegistry('', 'dockerhub') {
          dockerImage.push("${VERSION}_${GIT_COMMIT}_${BUILD_NUMBER}")
          }
          echo "Pushed Docker Image: ${REPO_USR}/${NAME_IMG}"
        } 
          sh "docker rmi ${REPO_USR}/${NAME_IMG}:${VERSION}_${GIT_COMMIT}_${BUILD_NUMBER} "
        }
    }   

  }
  parameters {
    string(name: 'PATHTO', defaultValue: 'Bash_scripts/HW27', description: null)
    string(name: 'VERSION', defaultValue: 'v1', description: null)
    string(name: 'NAME_IMG', defaultValue: 'hw28', description: null)
    string(name: 'REPO_USR', defaultValue: 'engelko', description: null)
  }
}
